{
    "version": "2.0.0",
    "tasks": [
        // Tarea 1: Inicializar Podman Compose (en la raíz)
        {
            "label": "setup: inicializar contenedores (Podman)",
            "type": "shell",
            // El comando se ejecuta en la carpeta raíz (D:\developer\proyectos\shop_books)
            "command": "podman compose up -d",
            "problemMatcher": [],
            "options": {
                // Ejecuta el comando en el directorio de trabajo actual (la raíz del proyecto)
                "cwd": "${workspaceFolder}"
            }
        },
        
        // Tarea 2: Iniciar el servidor Express (en el subdirectorio backend/api)
        {
            "label": "setup: iniciar servidor Express (pnpm dev)",
            "type": "shell",
            "command": "pnpm run dev",
            "isBackground": true, // Indica que este es un proceso de larga duración (servidor)
            "problemMatcher": "$tsc-watch", // Utiliza un matcher de problemas adecuado si es un proceso watch
            "options": {
                // IMPORTANTE: Cambia el directorio de trabajo al subdirectorio correcto
                "cwd": "${workspaceFolder}/backend/api"
            },
            "presentation": {
                "reveal": "always", // Muestra el terminal para ver el output del servidor
                "panel": "new",
                "group": "server"
            }
        },

        // Tarea 3: Tarea Maestra que llama a las anteriores y se ejecuta al abrir
        {
            "label": "INICIO DE PROYECTO (MAESTRA)",
            "dependsOn": [
                "setup: inicializar contenedores (Podman)",
                "setup: iniciar servidor Express (pnpm dev)"
            ],
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            // ESTO ES LO QUE HACE QUE SE EJECUTE AUTOMÁTICAMENTE
            "runOptions": {
                "runOn": "folderOpen" 
            }
        }
    ]
}